[{
    "id": "94b847a7.d2c4d8",
    "type": "tab",
    "label": "Rule Response Flow",
    "disabled": false,
    "info": ""
}, {
    "id": "37fdff63.77fab",
    "type": "watson-assistant-v2",
    "z": "94b847a7.d2c4d8",
    "name": "AlmanaK Duvidas Chatbot",
    "service-endpoint": "https://api.us-south.assistant.watson.cloud.ibm.com/instances/69a1a9db-4a21-4620-86aa-bfbf302851f7",
    "assistant_id": "285a2a67-dd1b-4d25-b6c4-077b6e762359",
    "debug": false,
    "restart": false,
    "return_context": false,
    "alternate_intents": false,
    "multisession": true,
    "timeout": "",
    "optout-learning": false,
    "persist-session-id": false,
    "x": 880,
    "y": 200,
    "wires": [
        ["8ffc5193.258ad", "63054acb.6ec004"]
    ]
}, {
    "id": "cf374b94.7567a8",
    "type": "inject",
    "z": "94b847a7.d2c4d8",
    "name": "",
    "props": [{
        "p": "payload"
    }, {
        "p": "msg.params.session_id",
        "v": "null",
        "vt": "json"
    }, {
        "p": "jogo",
        "v": "1",
        "vt": "str"
    }, {
        "p": "fonte",
        "v": "inject",
        "vt": "str"
    }],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "Como se da inicio ao jogo de taco?",
    "payloadType": "str",
    "x": 650,
    "y": 80,
    "wires": [
        ["8991fae3.2cd288", "37fdff63.77fab"]
    ]
}, {
    "id": "8991fae3.2cd288",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Inject",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 810,
    "y": 80,
    "wires": []
}, {
    "id": "8ffc5193.258ad",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Almanak Duvidas Chatbot",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1170,
    "y": 280,
    "wires": []
}, {
    "id": "63054acb.6ec004",
    "type": "function",
    "z": "94b847a7.d2c4d8",
    "name": "Chatbot Adj",
    "func": "function formatPayloadEntitites(payload){\n    let formattedPayload = {};\n    payload.output.entities.forEach(entity => {\n        let entityData = formattedPayload[entity.entity];   \n        if(entityData){\n            entityData.push(entity.value);\n            formattedPayload[entity.entity] = entityData;\n        }\n        else{\n            formattedPayload[entity.entity] = [entity.value];\n        }\n    })\n    return formattedPayload;\n}\n\nfunction formatPayloadIntents(payload){\n    let formattedPayload = {};\n    payload.output.intents.forEach(intent => {\n\n        formattedPayload = [intent.intent];\n\n    })\n    return formattedPayload;\n}\n\nmsg.busca = {}\n\nmsg.busca.intents = formatPayloadIntents(msg.payload)\nmsg.busca.entities = formatPayloadEntitites(msg.payload)\n\nmsg.payload = msg.busca\n\ndelete msg.busca\n\nreturn msg",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1130,
    "y": 200,
    "wires": [
        ["c165ea5b.77a8d8", "12710d61.1188d3"]
    ]
}, {
    "id": "c165ea5b.77a8d8",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Chatbot Adj",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1330,
    "y": 120,
    "wires": []
}, {
    "id": "12710d61.1188d3",
    "type": "http request",
    "z": "94b847a7.d2c4d8",
    "name": "Http Regra",
    "method": "POST",
    "ret": "obj",
    "paytoqs": "ignore",
    "url": "https://almanak-fiap.herokuapp.com/api/regra/resposta/{{{jogo}}}",
    "tls": "",
    "persist": false,
    "proxy": "",
    "authType": "",
    "x": 1330,
    "y": 200,
    "wires": [
        ["2cabba00.51c2d6", "a4462935.94bf68"]
    ]
}, {
    "id": "2cabba00.51c2d6",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Http Regra",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1530,
    "y": 280,
    "wires": []
}, {
    "id": "a4462935.94bf68",
    "type": "function",
    "z": "94b847a7.d2c4d8",
    "name": "Http Regra Adj",
    "func": "msg.size = msg.payload.length\n\nlet resposta = ''\n\nfor(var i = 0; i < msg.payload.length; i++){\n    resposta += msg.payload[i].desc\n}\n\nmsg.payload = resposta\n\nreturn msg",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1540,
    "y": 200,
    "wires": [
        ["25a7415b.6f844e", "9b2d0252.b5da4"]
    ]
}, {
    "id": "25a7415b.6f844e",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Http Regra Adj",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1760,
    "y": 120,
    "wires": []
}, {
    "id": "94cf322a.c7664",
    "type": "function",
    "z": "94b847a7.d2c4d8",
    "name": "TTS Adj",
    "func": "msg.payload = msg.speech\n\n\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1900,
    "y": 200,
    "wires": [
        ["5549e24e.405c7c", "82468014.9acf2"]
    ]
}, {
    "id": "e74c3aac.60d658",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "TTS",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1890,
    "y": 280,
    "wires": []
}, {
    "id": "5549e24e.405c7c",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "TTS Adj",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2080,
    "y": 120,
    "wires": []
}, {
    "id": "9b2d0252.b5da4",
    "type": "watson-text-to-speech",
    "z": "94b847a7.d2c4d8",
    "name": "TTS",
    "lang": "pt-BR",
    "langhidden": "pt-BR",
    "langcustom": "NoCustomisationSetting",
    "langcustomhidden": "",
    "voice": "pt-BR_IsabelaV3Voice",
    "voicehidden": "",
    "format": "audio/wav",
    "password": "",
    "apikey": "Ag9667g43j3R89gNzXASTVbSajQPmqR4mXHGc949-3Lm",
    "payload-response": true,
    "service-endpoint": "https://api.us-south.text-to-speech.watson.cloud.ibm.com/instances/008bbc42-3754-4a91-b7ee-1a624c992930",
    "x": 1730,
    "y": 200,
    "wires": [
        ["94cf322a.c7664", "e74c3aac.60d658"]
    ]
}, {
    "id": "4c813506.7ee2dc",
    "type": "http in",
    "z": "94b847a7.d2c4d8",
    "name": "[GET] Duvidas Endpoint",
    "url": "/api/wa/duvidas/:id",
    "method": "get",
    "upload": false,
    "swaggerDoc": "",
    "x": 200,
    "y": 200,
    "wires": [
        ["497aaf3e.646ca", "b38c796d.3c36f8"]
    ]
}, {
    "id": "497aaf3e.646ca",
    "type": "function",
    "z": "94b847a7.d2c4d8",
    "name": "",
    "func": "msg.payload = 'Como se da inicio ao jogo de taco?'\n\nmsg.params = {}\nmsg.params.session_id = null\n\nmsg.fonte = 'http'\n\nmsg.jogo = msg.req.params.id\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 460,
    "y": 200,
    "wires": [
        ["3bc43783.2974c8", "37fdff63.77fab"]
    ]
}, {
    "id": "b38c796d.3c36f8",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "GET",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 450,
    "y": 120,
    "wires": []
}, {
    "id": "3bc43783.2974c8",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "GET Adj",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 620,
    "y": 260,
    "wires": []
}, {
    "id": "82468014.9acf2",
    "type": "switch",
    "z": "94b847a7.d2c4d8",
    "name": "Filtro Fonte",
    "property": "fonte",
    "propertyType": "msg",
    "rules": [{
        "t": "eq",
        "v": "http",
        "vt": "str"
    }, {
        "t": "else"
    }],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 2090,
    "y": 200,
    "wires": [
        ["daf2f0c7.05447"],
        []
    ]
}, {
    "id": "daf2f0c7.05447",
    "type": "http response",
    "z": "94b847a7.d2c4d8",
    "name": "Duvidas Endpoint",
    "statusCode": "",
    "headers": {},
    "x": 2310,
    "y": 160,
    "wires": []
}, {
    "id": "769a7c5c.e5a744",
    "type": "play audio",
    "z": "94b847a7.d2c4d8",
    "name": "",
    "voice": "",
    "x": 2290,
    "y": 240,
    "wires": []
}, {
    "id": "6394750c.cfa01c",
    "type": "http in",
    "z": "94b847a7.d2c4d8",
    "name": "[POST] Duvidas Endpoint",
    "url": "/api/wa/duvidas/:idUsuario/:idJogo",
    "method": "post",
    "upload": true,
    "swaggerDoc": "",
    "x": 210,
    "y": 520,
    "wires": [
        ["6514bdd2.1f6424", "94075b25.7b19e8"]
    ]
}, {
    "id": "6514bdd2.1f6424",
    "type": "function",
    "z": "94b847a7.d2c4d8",
    "name": "Adj Inicial",
    "func": "msg.params = {}\nmsg.params.session_id = null\n\nmsg.fonte = 'http'\n\nmsg.jogo = msg.req.params.idJogo\nmsg.usuario = msg.req.params.idUsuario\n\nmsg.headers={\n    \"Content-Type\": \"audio/wav\",\n}\nmsg['data-binary']={\n    \"@\":msg.payload\n}\n\nmsg['payload'] = msg.req.files[0].buffer;\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 460,
    "y": 520,
    "wires": [
        ["f8d8ffe.2c95b", "fa99fdd6.a7d43"]
    ]
}, {
    "id": "94075b25.7b19e8",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "POST",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 450,
    "y": 600,
    "wires": []
}, {
    "id": "f8d8ffe.2c95b",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "POST Adj",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 640,
    "y": 440,
    "wires": []
}, {
    "id": "bafa6e43.26f44",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "STT Port",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1060,
    "y": 440,
    "wires": []
}, {
    "id": "ef5cdab4.676658",
    "type": "watson-speech-to-text",
    "z": "94b847a7.d2c4d8",
    "name": "STT Port",
    "alternatives": 1,
    "speakerlabels": true,
    "smartformatting": false,
    "lang": "pt-BR",
    "langhidden": "pt-BR",
    "langcustom": "NoCustomisationSetting",
    "langcustomhidden": "",
    "custom-weight": "0.5",
    "band": "BroadbandModel",
    "bandhidden": "",
    "keywords": "",
    "keywords-threshold": "0.5",
    "word-confidence": false,
    "password": "",
    "apikey": "TJUvqW20jvSroPIy93orQepjtRyflt7LH7tiZL1OmgoT",
    "payload-response": true,
    "streaming-mode": false,
    "streaming-mute": true,
    "auto-connect": false,
    "discard-listening": false,
    "disable-precheck": false,
    "service-endpoint": "https://api.us-south.speech-to-text.watson.cloud.ibm.com/instances/5fb82473-fa2f-488a-9713-6285112950ed",
    "x": 880,
    "y": 520,
    "wires": [
        ["4bda8e30.d6e29", "bafa6e43.26f44"]
    ]
}, {
    "id": "4bda8e30.d6e29",
    "type": "watson-assistant-v2",
    "z": "94b847a7.d2c4d8",
    "name": "AlmanaK Duvidas Chatbot",
    "service-endpoint": "https://api.us-south.assistant.watson.cloud.ibm.com/instances/69a1a9db-4a21-4620-86aa-bfbf302851f7",
    "assistant_id": "285a2a67-dd1b-4d25-b6c4-077b6e762359",
    "debug": false,
    "restart": false,
    "return_context": false,
    "alternate_intents": false,
    "multisession": true,
    "timeout": "",
    "optout-learning": false,
    "persist-session-id": false,
    "x": 1120,
    "y": 520,
    "wires": [
        ["dc83896a.a7a548", "38ca875f.eecca8"]
    ]
}, {
    "id": "dc83896a.a7a548",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Almanak Duvidas Chatbot",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1410,
    "y": 600,
    "wires": []
}, {
    "id": "38ca875f.eecca8",
    "type": "function",
    "z": "94b847a7.d2c4d8",
    "name": "Chatbot Adj",
    "func": "function formatPayloadEntitites(payload){\n    let formattedPayload = {};\n    payload.output.entities.forEach(entity => {\n        let entityData = formattedPayload[entity.entity];   \n        if(entityData){\n            entityData.push(entity.value);\n            formattedPayload[entity.entity] = entityData;\n        }\n        else{\n            formattedPayload[entity.entity] = [entity.value];\n        }\n    })\n    return formattedPayload;\n}\n\nfunction formatPayloadIntents(payload){\n    let formattedPayload = {};\n    payload.output.intents.forEach(intent => {\n\n        formattedPayload = [intent.intent];\n\n    })\n    return formattedPayload;\n}\n\nmsg.busca = {}\n\nmsg.busca.intents = formatPayloadIntents(msg.payload)\nmsg.busca.entities = formatPayloadEntitites(msg.payload)\n\nmsg.payload = msg.busca\n\nreturn msg",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1370,
    "y": 520,
    "wires": [
        ["8067f4c8.dca9a8", "a97398c4.40a768"]
    ]
}, {
    "id": "8067f4c8.dca9a8",
    "type": "http request",
    "z": "94b847a7.d2c4d8",
    "name": "Http Regra",
    "method": "POST",
    "ret": "obj",
    "paytoqs": "ignore",
    "url": "https://almanak-fiap.herokuapp.com/api/regra/resposta/{{{jogo}}}",
    "tls": "",
    "persist": false,
    "proxy": "",
    "authType": "",
    "x": 1570,
    "y": 520,
    "wires": [
        ["9ef92a4d.091228", "752602d7.fc806c"]
    ]
}, {
    "id": "9ef92a4d.091228",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Http Regra",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1770,
    "y": 600,
    "wires": []
}, {
    "id": "752602d7.fc806c",
    "type": "function",
    "z": "94b847a7.d2c4d8",
    "name": "Http Regra Adj",
    "func": "msg.size = msg.payload.length\n\nlet resposta = ''\n\nfor(var i = 0; i < msg.payload.length; i++){\n    resposta += msg.payload[i].desc\n}\n\nmsg.payload = resposta\n\nmsg.headers.accept = 'audio/wav'\n\nreturn msg",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1780,
    "y": 520,
    "wires": [
        ["c464223f.98929", "6d65e904.cbcbe8", "5d2f9724.92d068"]
    ]
}, {
    "id": "c529655e.12dd98",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "TTS",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2130,
    "y": 600,
    "wires": []
}, {
    "id": "c464223f.98929",
    "type": "watson-text-to-speech",
    "z": "94b847a7.d2c4d8",
    "name": "TTS",
    "lang": "pt-BR",
    "langhidden": "pt-BR",
    "langcustom": "NoCustomisationSetting",
    "langcustomhidden": "",
    "voice": "pt-BR_IsabelaV3Voice",
    "voicehidden": "",
    "format": "audio/wav",
    "password": "",
    "apikey": "N-O8OdAkORXt1DR43s9F_azBv7v_MCJabs9Kzp8hDECU",
    "payload-response": true,
    "service-endpoint": "https://api.us-south.text-to-speech.watson.cloud.ibm.com/instances/3ed1448f-c5b3-4d4d-965c-c30b46a38217",
    "x": 1970,
    "y": 520,
    "wires": [
        ["c529655e.12dd98", "ff6dee50.9d55c"]
    ]
}, {
    "id": "ff6dee50.9d55c",
    "type": "http response",
    "z": "94b847a7.d2c4d8",
    "name": "Duvidas Endpoint",
    "statusCode": "",
    "headers": {},
    "x": 2170,
    "y": 520,
    "wires": []
}, {
    "id": "6d65e904.cbcbe8",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Http Regra Adj",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2000,
    "y": 440,
    "wires": []
}, {
    "id": "fa99fdd6.a7d43",
    "type": "ffmpeg-conversion",
    "z": "94b847a7.d2c4d8",
    "name": "",
    "format": "wav",
    "audiochannels": "mono",
    "x": 670,
    "y": 520,
    "wires": [
        ["ef5cdab4.676658", "ea0fc34a.48cfa"]
    ]
}, {
    "id": "ea0fc34a.48cfa",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "ffmmpeg conversion",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 920,
    "y": 600,
    "wires": []
}, {
    "id": "a97398c4.40a768",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Chatbot Adj",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1570,
    "y": 460,
    "wires": []
}, {
    "id": "5d2f9724.92d068",
    "type": "function",
    "z": "94b847a7.d2c4d8",
    "name": "",
    "func": "msg.busca.duvida = msg.transcription\nmsg.busca.jogo = msg.jogo\n\nmsg.busca.wa = {}\n\nmsg.busca.wa.intents = msg.busca.intents\nmsg.busca.wa.entities = msg.busca.entities\n\ndelete msg.busca.intents\ndelete msg.busca.entities\n\nmsg.payload = msg.busca\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1980,
    "y": 660,
    "wires": [
        ["d97aa73d.9661e8", "913ff5ca.dd2ff8"]
    ]
}, {
    "id": "d97aa73d.9661e8",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Chatbot Adj",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2150,
    "y": 720,
    "wires": []
}, {
    "id": "913ff5ca.dd2ff8",
    "type": "http request",
    "z": "94b847a7.d2c4d8",
    "name": "Http Salvar Duvida",
    "method": "POST",
    "ret": "obj",
    "paytoqs": "ignore",
    "url": "https://almanak-fiap.herokuapp.com/api/atividade/duvida/{{{usuario}}}",
    "tls": "",
    "persist": false,
    "proxy": "",
    "authType": "",
    "x": 2190,
    "y": 660,
    "wires": [
        ["e0a0048f.2baa98"]
    ]
}, {
    "id": "e0a0048f.2baa98",
    "type": "debug",
    "z": "94b847a7.d2c4d8",
    "name": "Http Salvar Duvida",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2430,
    "y": 660,
    "wires": []
}]